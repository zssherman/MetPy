

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developer’s Guide &mdash; MetPy 0.7</title>
  

  
  
    <link rel="shortcut icon" href="_static/metpy_32x32.ico"/>
  
  
  
    <link rel="canonical" href="https://unidata.github.io/MetPy/latest/developerguide.html"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="MetPy 0.7" href="index.html"/>
        <link rel="next" title="Contributing" href="CONTRIBUTING.html"/>
        <link rel="prev" title="GEMPAK Conversion Guide" href="gempak.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> MetPy
          

          
            
            <img src="_static/metpy_150x150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>0.7</option>
                      
                        
                          <option value="../latest">latest</option>
                        
                      
                        
                          <option value="../dev">dev</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installguide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Unit Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">MetPy Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">MetPy Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">The MetPy API</a></li>
<li class="toctree-l1"><a class="reference internal" href="gempak.html">GEMPAK Conversion Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer’s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conda">Conda</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#making-changes">Making Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-style">Code Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-tools">Other Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#releasing">Releasing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pypi">PyPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Conda</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing MetPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MetPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Developer’s Guide</li>
    
    
    <li class="source-link">
        
            
                <a href="https://github.com/Unidata/MetPy/edit/master/docs/developerguide.rst"
                   class="fa fa-github"> Improve this page</a>
            
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developer-s-guide">
<h1>Developer’s Guide<a class="headerlink" href="#developer-s-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>pytest &gt;= 2.4</li>
<li>flake8</li>
<li>sphinx &gt;= 1.3</li>
<li>sphinx-rtd-theme &gt;= 0.1.7</li>
<li>nbconvert&gt;=4.1</li>
</ul>
<div class="section" id="conda">
<h3>Conda<a class="headerlink" href="#conda" title="Permalink to this headline">¶</a></h3>
<p>Settings up a development environment in MetPy is as easy as (from the
base of the repository):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">env</span> <span class="n">create</span>
<span class="n">conda</span> <span class="n">develop</span> <span class="o">-</span><span class="n">n</span> <span class="n">devel</span> <span class="o">.</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> contains all of the configuration needed to easily
set up the environment, called <code class="docutils literal notranslate"><span class="pre">devel</span></code>. The second line sets up conda to
run directly out of the git repository.</p>
</div>
</div>
<div class="section" id="making-changes">
<h2>Making Changes<a class="headerlink" href="#making-changes" title="Permalink to this headline">¶</a></h2>
<p>The changes to the MetPy source (and documentation) should be made via GitHub pull requests
against <code class="docutils literal notranslate"><span class="pre">master</span></code>, even for those with administration rights. While it’s tempting to
make changes directly to <code class="docutils literal notranslate"><span class="pre">master</span></code> and push them up, it is better to make a pull request so
that others can give feedback. If nothing else, this gives a chance for the automated tests to
run on the PR. This can eliminate “brown paper bag” moments with buggy commits on the master
branch.</p>
<p>During the Pull Request process, before the final merge, it’s a good idea to rebase the branch
and squash together smaller commits. It’s not necessary to flatten the entire branch, but it
can be nice to eliminate small fixes and get the merge down to logically arranged commit. This
can also be used to hide sins from history–this is the only chance, since once it hits
<code class="docutils literal notranslate"><span class="pre">master</span></code>, it’s there forever!</p>
</div>
<div class="section" id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h2>
<p>To manage identifying the version of the code, MetPy relies upon <a class="reference external" href="https://github.com/warner/python-versioneer">versioneer</a>. <code class="docutils literal notranslate"><span class="pre">versioneer</span></code> takes the current version of
the source from git tags and any additional commits. For development, the version will have a
string like <code class="docutils literal notranslate"><span class="pre">0.1.1+76.g136e37b.dirty</span></code>, which comes from <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span></code>. This version means
that the current code is 76 commits past the 0.1.1 tag, on git hash <code class="docutils literal notranslate"><span class="pre">136e37b</span></code>, with local
changes on top (indicated by <code class="docutils literal notranslate"><span class="pre">dirty</span></code>). For a release, or non-git repo source dir, the version
will just come from the most recent tag (i.e. <code class="docutils literal notranslate"><span class="pre">v0.1.1</span></code>).</p>
<p>To make a new version, simply add a new tag with a name like <code class="docutils literal notranslate"><span class="pre">vMajor.Minor.Bugfix</span></code> and push
to GitHub. Github will add a new release with a source archive.zip file. Running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">sdist</span>
</pre></div>
</div>
<p>will build a new source distribution with the appropriately generated version file as well.
This will also create a new stable set of documentation.</p>
<p><code class="docutils literal notranslate"><span class="pre">versioneer</span></code> is installed in the base of the repository. To update, install the latest copy
using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">versioneer</span></code>. Then recreate the <code class="docutils literal notranslate"><span class="pre">_version.py</span></code> file using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">versioneer</span>
</pre></div>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>Unit tests are the lifeblood of the project, as it ensures that we can continue to add and
change the code and stay confident that things have not broken. Running the tests requires
<code class="docutils literal notranslate"><span class="pre">pytest</span></code>, which is easily available through <code class="docutils literal notranslate"><span class="pre">conda</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span></code>. Running the tests can be
done via either:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">py</span><span class="o">.</span><span class="n">test</span>
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">py.test</span></code> also gives you the option of passing a path to the directory with tests to
run, which can speed running only the tests of interest when doing development. For instance,
to only run the tests in the <code class="docutils literal notranslate"><span class="pre">metpy/calc</span></code> directory, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">py</span><span class="o">.</span><span class="n">test</span> <span class="n">metpy</span><span class="o">/</span><span class="n">calc</span>
</pre></div>
</div>
<p>Some tests (for matplotlib plotting code) are done through an image comparison, using the
pytest-mpl plugin. To run these tests, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">py</span><span class="o">.</span><span class="n">test</span> <span class="o">--</span><span class="n">mpl</span>
</pre></div>
</div>
<p>When adding new image comparison tests, start by creating the baseline images for the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">py</span><span class="o">.</span><span class="n">test</span> <span class="o">--</span><span class="n">mpl</span><span class="o">-</span><span class="n">generate</span><span class="o">-</span><span class="n">path</span><span class="o">=</span><span class="n">baseline</span>
</pre></div>
</div>
<p>That command runs the tests and saves the images in the <code class="docutils literal notranslate"><span class="pre">baseline</span></code> directory. Once the images
are reviewed and determined to be correct, they should be moved to a <code class="docutils literal notranslate"><span class="pre">baseline</span></code> directory in
the same directory as the test script (e.g. <code class="docutils literal notranslate"><span class="pre">metpy/plots/tests</span></code>) For more information, see
the <a class="reference external" href="https://github.com/astrofrog/pytest-mpl">docs for mpl-test</a>.</p>
</div>
<div class="section" id="code-style">
<h2>Code Style<a class="headerlink" href="#code-style" title="Permalink to this headline">¶</a></h2>
<p>MetPy uses the Python code style outlined in <a class="reference external" href="http://pep8.org">PEP8</a>. For better or worse, this is what the majority
of the Python world uses. The one deviation is that line length limit is 95 characters. 80 is a
good target, but some times longer lines are needed.</p>
<p>While the authors are no fans of blind adherence to style and so-called project “clean-ups”
that go through and correct code style, MetPy has adopted this style from the outset.
Therefore, it makes sense to enforce this style as code is added to keep everything clean and
uniform. To this end, part of the automated testing for MetPy checks style. To check style
locally within the source directory you can use the <code class="docutils literal notranslate"><span class="pre">flake8</span></code> tool. Running it
from the root of the source directory is as easy as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flake8</span> <span class="n">metpy</span>
</pre></div>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>MetPy’s documentation is built using sphinx &gt;= 1.4. API documentation is automatically
generated from docstrings, written using the
<a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">NumPy docstring standard</a>.
There are also example scripts in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> directory. Using the <code class="docutils literal notranslate"><span class="pre">sphinx-gallery</span></code>
extension, these examples are executed and turned into a gallery of thumbnails. The
extension also makes these scripts available as Jupyter notebooks.</p>
<p>The documentation is hosted on <a class="reference external" href="https://unidata.github.io/MetPy">GitHub Pages</a>. The docs are
built automatically from <code class="docutils literal notranslate"><span class="pre">master</span></code> with every build on Travis-CI; every merged PR will
have the built docs upload to GitHub Pages. As part of the build, the documentation is also
checked with <code class="docutils literal notranslate"><span class="pre">doc8</span></code>. To see what the docs will look like, you also need to install the
<code class="docutils literal notranslate"><span class="pre">sphinx-rtd-theme</span></code> package.</p>
</div>
<div class="section" id="other-tools">
<h2>Other Tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h2>
<p>Continuous integration is performed by <a class="reference external" href="http://www.travis-ci.org/Unidata/MetPy">Travis CI</a>
and <a class="reference external" href="https://ci.appveyor.com/project/Unidata/metpy/branch/master">AppVeyor</a>.
Travis runs the unit tests on Linux for all supported versions of Python, as well as runs
against the minimum package versions. <code class="docutils literal notranslate"><span class="pre">flake8</span></code> (with the <code class="docutils literal notranslate"><span class="pre">pep8-naming</span></code> and
<code class="docutils literal notranslate"><span class="pre">flake8-quotes</span></code> plugins) is also run against the code to check formatting. Travis is also
used to build the documentation and to run the examples to ensure they stay working. AppVeyor
is a similar service; here the tests and examples are run against Python 2 and 3 for both
32- and 64-bit versions of Windows.</p>
<p>Test coverage is monitored by <a class="reference external" href="https://codecov.io/github/Unidata/MetPy">codecov.io</a>.</p>
<p>The following services are used to track code quality:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.codacy.com/app/Unidata/MetPy/dashboard">Codacy</a></li>
<li><a class="reference external" href="https://codeclimate.com/github/Unidata/MetPy">Code Climate</a></li>
<li><a class="reference external" href="https://scrutinizer-ci.com/g/Unidata/MetPy/?branch=master)">Scrutinizer</a></li>
</ul>
</div>
<div class="section" id="releasing">
<h2>Releasing<a class="headerlink" href="#releasing" title="Permalink to this headline">¶</a></h2>
<p>To create a new release, go to the GitHub page and make a new release. The tag should be a
sensible version number, like v1.0.0. Add a name (can just be the version) and add some release
notes on what the big changes are. It’s also possible to use
<a class="reference external" href="https://github.com/spyder-ide/loghub">loghub</a> to get information on all the issues and PRs
that were closed for the relevant milestone.</p>
<div class="section" id="pypi">
<h3>PyPI<a class="headerlink" href="#pypi" title="Permalink to this headline">¶</a></h3>
<p>Once the new release is published on GitHub, this will create the tag, which will trigger
new builds on Travis (and AppVeyor, but that’s not relevant). When the main test build on
Travis (currently Python 3 tests) succeeds, Travis will handle building the source
distribution and wheels, and upload them to PyPI.</p>
<p>To build and upload manually (if for some reason it is necessary):</p>
<ol class="arabic simple">
<li>Do a pull locally to grab the new tag. This will ensure that <code class="docutils literal notranslate"><span class="pre">versioneer</span></code> will give you
the proper version.</li>
<li>(optional) Perform a <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-f</span> <span class="pre">-x</span> <span class="pre">-d</span></code> from the root of the repository. This will
<strong>delete</strong> everything not tracked by git, but will also ensure clean source distribution.
<code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code> is set to include/exclude mostly correctly, but could miss some things.</li>
<li>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">sdist</span> <span class="pre">bdist_wheel</span></code> (this requires that <code class="docutils literal notranslate"><span class="pre">wheel</span></code> is installed).</li>
<li>Upload using <code class="docutils literal notranslate"><span class="pre">twine</span></code>: <code class="docutils literal notranslate"><span class="pre">twine</span> <span class="pre">upload</span> <span class="pre">dist/*</span></code>, assuming the <code class="docutils literal notranslate"><span class="pre">dist/</span></code> directory contains
only files for this release. This upload process will include any changes to the <code class="docutils literal notranslate"><span class="pre">README</span></code>
as well as any updated flags from <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>.</li>
</ol>
</div>
<div class="section" id="id1">
<h3>Conda<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>MetPy conda packages are automatically produced and uploaded to
<a class="reference external" href="https://anaconda.org/conda-forge/MetPy">Anaconda.org</a> thanks to conda-forge. Once the
release is built and uploaded to PyPI, then a Pull Request should be made against the
<a class="reference external" href="https://github.com/conda-forge/metpy-feedstock">MetPy feedstock</a>, which contains the
recipe for building MetPy’s conda packages. The Pull Request should:</p>
<ol class="arabic simple">
<li>Update the version</li>
<li>Update the hash to match that of the new source distribution <strong>uploaded to PyPI</strong></li>
<li>Reset the build number to 0 (if necessary)</li>
<li>Update the dependencies (and their versions) as necessary</li>
</ol>
<p>The Pull Request will test building the packages on all the platforms. Once this succeeds,
the Pull Request can be merged, which will trigger the final build and upload of the
packages to anaconda.org.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="CONTRIBUTING.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gempak.html" class="btn btn-neutral" title="GEMPAK Conversion Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, MetPy Developers.
      Last updated on Apr 12, 2018 at 00:47:55.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92978945-1', 'auto');
  ga('send', 'pageview');
</script>
<script>var version_json_loc = "../versions.json";</script>
<p>Do you enjoy using MetPy?
  <a href="https://saythanks.io/to/unidata" class="btn btn-neutral" title="Say Thanks!" accesskey="n">Say Thanks!</a>
</p>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0+135.gaac1d34',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="_static/pop_ver.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>