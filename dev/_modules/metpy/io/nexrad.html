

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>metpy.io.nexrad &mdash; MetPy 0.7</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/metpy_32x32.ico"/>
  
  
  
    <link rel="canonical" href="https://unidata.github.io/MetPy/latest/_modules/metpy/io/nexrad.html"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/theme_override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="MetPy 0.7" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> MetPy
          

          
            
            <img src="../../../_static/metpy_150x150.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>0.7</option>
                      
                        
                          <option value="../latest">latest</option>
                        
                      
                        
                          <option value="../dev">dev</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installguide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../units.html">Unit Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">MetPy Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">MetPy Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">The MetPy API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gempak.html">GEMPAK Conversion Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developerguide.html">Developerâ€™s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../citing.html">Citing MetPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MetPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>metpy.io.nexrad</li>
    
    
    <li class="source-link">
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for metpy.io.nexrad</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2009,2015,2016,2017 MetPy Developers.</span>
<span class="c1"># Distributed under the terms of the BSD 3-Clause License.</span>
<span class="c1"># SPDX-License-Identifier: BSD-3-Clause</span>
<span class="sd">&quot;&quot;&quot;Support reading information from various NEXRAD formats.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">bz2</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">namedtuple</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="k">import</span> <span class="n">Struct</span>
<span class="kn">from</span> <span class="nn">xdrlib</span> <span class="k">import</span> <span class="n">Unpacker</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="k">import</span> <span class="n">day</span><span class="p">,</span> <span class="n">milli</span>

<span class="kn">from</span> <span class="nn">._tools</span> <span class="k">import</span> <span class="p">(</span><span class="n">Array</span><span class="p">,</span> <span class="n">BitField</span><span class="p">,</span> <span class="n">Bits</span><span class="p">,</span> <span class="n">bits_to_code</span><span class="p">,</span> <span class="n">DictStruct</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">IOBuffer</span><span class="p">,</span>
                     <span class="n">NamedStruct</span><span class="p">,</span> <span class="n">open_as_needed</span><span class="p">,</span> <span class="n">zlib_decompress_all_frames</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..cbook</span> <span class="k">import</span> <span class="n">is_string_like</span>
<span class="kn">from</span> <span class="nn">..package_tools</span> <span class="k">import</span> <span class="n">Exporter</span>

<span class="n">exporter</span> <span class="o">=</span> <span class="n">Exporter</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate a string version from an integer value.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">/</span> <span class="mf">100.</span> <span class="o">&gt;</span> <span class="mf">2.</span><span class="p">:</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="mf">100.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="mf">10.</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ver</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">scaler</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function that scales by a specific value.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert an integer value to a floating point angle.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">val</span> <span class="o">*</span> <span class="mf">360.</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>


<span class="k">def</span> <span class="nf">az_rate</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert an integer value to a floating point angular rate.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">val</span> <span class="o">*</span> <span class="mf">90.</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>


<span class="k">def</span> <span class="nf">bzip_blocks_decompress_all</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decompress all of the bzip2-ed blocks.</span>

<span class="sd">    Returns the decompressed data as a `bytearray`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">size_bytes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">block_cmp_bytes</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;&gt;l&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">size_bytes</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">frames</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bz2</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span> <span class="o">+</span> <span class="n">block_cmp_bytes</span><span class="p">]))</span>
            <span class="n">offset</span> <span class="o">+=</span> <span class="n">block_cmp_bytes</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># If we&#39;ve decompressed any frames, this is an error mid-stream, so warn, stop</span>
            <span class="c1"># trying to decompress and let processing proceed</span>
            <span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error decompressing bz2 block stream at offset: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                                <span class="n">offset</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Otherwise, this isn&#39;t a bzip2 stream, so bail</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not a bz2 stream.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frames</span>


<span class="k">def</span> <span class="nf">nexrad_to_datetime</span><span class="p">(</span><span class="n">julian_date</span><span class="p">,</span> <span class="n">ms_midnight</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert NEXRAD date time format to python `datetime.datetime`.&quot;&quot;&quot;</span>
    <span class="c1"># Subtracting one from julian_date is because epoch date is 1</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">((</span><span class="n">julian_date</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">day</span> <span class="o">+</span>
                                              <span class="n">ms_midnight</span> <span class="o">*</span> <span class="n">milli</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">remap_status</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert status integer value to appropriate bitmask.&quot;&quot;&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="n">BAD_DATA</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xF0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">val</span> <span class="o">&amp;=</span> <span class="mh">0x0F</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">START_ELEVATION</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">END_ELEVATION</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">START_ELEVATION</span> <span class="o">|</span> <span class="n">START_VOLUME</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">END_ELEVATION</span> <span class="o">|</span> <span class="n">END_VOLUME</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">START_ELEVATION</span> <span class="o">|</span> <span class="n">LAST_ELEVATION</span>

    <span class="k">return</span> <span class="n">status</span> <span class="o">|</span> <span class="n">bad</span>


<span class="n">START_ELEVATION</span> <span class="o">=</span> <span class="mh">0x1</span>
<span class="n">END_ELEVATION</span> <span class="o">=</span> <span class="mh">0x2</span>
<span class="n">START_VOLUME</span> <span class="o">=</span> <span class="mh">0x4</span>
<span class="n">END_VOLUME</span> <span class="o">=</span> <span class="mh">0x8</span>
<span class="n">LAST_ELEVATION</span> <span class="o">=</span> <span class="mh">0x10</span>
<span class="n">BAD_DATA</span> <span class="o">=</span> <span class="mh">0x20</span>


<div class="viewcode-block" id="Level2File"><a class="viewcode-back" href="../../../api/generated/metpy.io.Level2File.html#metpy.io.Level2File">[docs]</a><span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">Level2File</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Handle reading the NEXRAD Level 2 data and its various messages.</span>

<span class="sd">    This class attempts to decode every byte that is in a given data file.</span>
<span class="sd">    It supports both external compression, as well as the internal BZ2</span>
<span class="sd">    compression that is used.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    stid : str</span>
<span class="sd">        The ID of the radar station</span>
<span class="sd">    dt : Datetime instance</span>
<span class="sd">        The date and time of the data</span>
<span class="sd">    vol_hdr : namedtuple</span>
<span class="sd">        The unpacked volume header</span>
<span class="sd">    sweeps : list of tuples</span>
<span class="sd">        Data for each of the sweeps found in the file</span>
<span class="sd">    rda_status : namedtuple, optional</span>
<span class="sd">        Unpacked RDA status information, if found</span>
<span class="sd">    maintenance_data : namedtuple, optional</span>
<span class="sd">        Unpacked maintenance data information, if found</span>
<span class="sd">    maintenance_data_desc : dict, optional</span>
<span class="sd">        Descriptions of maintenance data fields, if maintenance data present</span>
<span class="sd">    vcp_info : namedtuple, optional</span>
<span class="sd">        Unpacked VCP information, if found</span>
<span class="sd">    clutter_filter_bypass_map : dict, optional</span>
<span class="sd">        Unpacked clutter filter bypass map, if present</span>
<span class="sd">    rda : dict, optional</span>
<span class="sd">        Unpacked RDA adaptation data, if present</span>
<span class="sd">    rda_adaptation_desc : dict, optional</span>
<span class="sd">        Descriptions of RDA adaptation data, if adaptation data present</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The internal data structure that things are decoded into is still to be</span>
<span class="sd">    determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Number of bytes</span>
    <span class="n">AR2_BLOCKSIZE</span> <span class="o">=</span> <span class="mi">2432</span>  <span class="c1"># 12 (CTM) + 2416 (Msg hdr + data) + 4 (FCS)</span>
    <span class="n">CTM_HEADER_SIZE</span> <span class="o">=</span> <span class="mi">12</span>

    <span class="n">MISSING</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
    <span class="n">RANGE_FOLD</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>  <span class="c1"># TODO: Need to separate from missing</span>

<div class="viewcode-block" id="Level2File.__init__"><a class="viewcode-back" href="../../../api/generated/metpy.io.Level2File.html#metpy.io.Level2File.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create instance of `Level2File`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str or file-like object</span>
<span class="sd">            If str, the name of the file to be opened. Gzip-ed files are</span>
<span class="sd">            recognized with the extension &#39;.gz&#39;, as are bzip2-ed files with</span>
<span class="sd">            the extension `.bz2` If `fname` is a file-like object,</span>
<span class="sd">            this will be read from directly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">open_as_needed</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">closing</span><span class="p">(</span><span class="n">fobj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">IOBuffer</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_read_volume_header</span><span class="p">()</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>

        <span class="c1"># See if we need to apply bz2 decompression</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">IOBuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_func</span><span class="p">(</span><span class="n">bzip_blocks_decompress_all</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>

        <span class="c1"># Now we&#39;re all initialized, we can proceed with reading in data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_data</span><span class="p">()</span></div>

    <span class="n">vol_hdr_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;9s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vol_num&#39;</span><span class="p">,</span> <span class="s1">&#39;3s&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;time_ms&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;stid&#39;</span><span class="p">,</span> <span class="s1">&#39;4s&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;VolHdr&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_volume_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol_hdr_fmt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol_hdr</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol_hdr</span><span class="o">.</span><span class="n">time_ms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol_hdr</span><span class="o">.</span><span class="n">stid</span>

    <span class="n">msg_hdr_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;size_hw&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;rda_channel&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Redundant Channel 1&#39;</span><span class="p">,</span>
                                                             <span class="s1">&#39;Redundant Channel 2&#39;</span><span class="p">,</span>
                                                             <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ORDA&#39;</span><span class="p">)),</span>
                               <span class="p">(</span><span class="s1">&#39;msg_type&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;seq_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;time_ms&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_segments&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;segment_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)],</span>
                              <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;MsgHdr&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_buf</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rda_status</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">at_end</span><span class="p">():</span>
            <span class="c1"># Clear old file book marks and set the start of message for</span>
            <span class="c1"># easy jumping to the end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">clear_marks</span><span class="p">()</span>
            <span class="n">msg_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>

            <span class="c1"># Skip CTM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CTM_HEADER_SIZE</span><span class="p">)</span>

            <span class="c1"># Read the message header</span>
            <span class="n">msg_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg_hdr_fmt</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Got message: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">))</span>

            <span class="c1"># The AR2_BLOCKSIZE accounts for the CTM header before the</span>
            <span class="c1"># data, as well as the Frame Check Sequence (4 bytes) after</span>
            <span class="c1"># the end of the data.</span>
            <span class="n">msg_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AR2_BLOCKSIZE</span>

            <span class="c1"># If the size is 0, this is just padding, which is for certain</span>
            <span class="c1"># done in the metadata messages. Let the default block size handle rather</span>
            <span class="c1"># than any specific heuristic to skip.</span>
            <span class="k">if</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">size_hw</span><span class="p">:</span>
                <span class="c1"># For new packets, the message size isn&#39;t on the fixed size boundaries,</span>
                <span class="c1"># so we use header to figure out. For these, we need to include the</span>
                <span class="c1"># CTM header but not FCS, in addition to the size.</span>

                <span class="c1"># As of 2620002P, this is a special value used to indicate that the segment</span>
                <span class="c1"># number/count bytes are used to indicate total size in bytes.</span>
                <span class="k">if</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">size_hw</span> <span class="o">==</span> <span class="mi">65535</span><span class="p">:</span>
                    <span class="n">msg_bytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg_hdr</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">segment_num</span> <span class="o">+</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">CTM_HEADER_SIZE</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
                    <span class="n">msg_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CTM_HEADER_SIZE</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">size_hw</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Total message size: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">msg_bytes</span><span class="p">)</span>

                <span class="c1"># Try to handle the message. If we don&#39;t handle it, skipping</span>
                <span class="c1"># past it is handled at the end anyway.</span>
                <span class="n">decoder</span> <span class="o">=</span> <span class="s1">&#39;_decode_msg</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decoder</span><span class="p">):</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)(</span><span class="n">msg_hdr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unknown message: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span><span class="p">)</span>

            <span class="c1"># Jump to the start of the next message. This depends on whether</span>
            <span class="c1"># the message was legacy with fixed block size or not.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="n">msg_bytes</span><span class="p">)</span>

        <span class="c1"># Check if we have any message segments still in the buffer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_buf</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Remaining buffered messages segments for message type(s): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_buf</span><span class="p">)))</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_buf</span>

    <span class="n">msg1_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;time_ms&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;unamb_range&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;az_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;az_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rad_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">remap_status</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;el_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;surv_first_gate&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;doppler_first_gate&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;surv_gate_width&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;doppler_gate_width&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;surv_num_gates&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;doppler_num_gates&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;cut_sector_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;calib_dbz0&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;ref_offset&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vel_offset&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sw_offset&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;dop_res&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;vcp&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;14x&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;nyq_vel&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;atmos_atten&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;tover&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;spot_blanking&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Radial&#39;</span><span class="p">,</span> <span class="s1">&#39;Elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;Volume&#39;</span><span class="p">)),</span>
                            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;32x&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Msg1Fmt&#39;</span><span class="p">)</span>

    <span class="n">msg1_data_hdr</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Msg1DataHdr&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;name first_gate gate_width num_gates scale offset&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_msg1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="n">msg_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg1_fmt</span><span class="p">)</span>
        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Process all data pointers:</span>
        <span class="n">read_info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hdr</span><span class="o">.</span><span class="n">surv_num_gates</span> <span class="ow">and</span> <span class="n">hdr</span><span class="o">.</span><span class="n">ref_offset</span><span class="p">:</span>
            <span class="n">read_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hdr</span><span class="o">.</span><span class="n">ref_offset</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">msg1_data_hdr</span><span class="p">(</span><span class="s1">&#39;REF&#39;</span><span class="p">,</span> <span class="n">hdr</span><span class="o">.</span><span class="n">surv_first_gate</span><span class="p">,</span>
                                                 <span class="n">hdr</span><span class="o">.</span><span class="n">surv_gate_width</span><span class="p">,</span>
                                                 <span class="n">hdr</span><span class="o">.</span><span class="n">surv_num_gates</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">66.0</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">hdr</span><span class="o">.</span><span class="n">vel_offset</span><span class="p">:</span>
            <span class="n">read_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hdr</span><span class="o">.</span><span class="n">vel_offset</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">msg1_data_hdr</span><span class="p">(</span><span class="s1">&#39;VEL&#39;</span><span class="p">,</span> <span class="n">hdr</span><span class="o">.</span><span class="n">doppler_first_gate</span><span class="p">,</span>
                                                 <span class="n">hdr</span><span class="o">.</span><span class="n">doppler_gate_width</span><span class="p">,</span>
                                                 <span class="n">hdr</span><span class="o">.</span><span class="n">doppler_num_gates</span><span class="p">,</span>
                                                 <span class="mf">1.</span> <span class="o">/</span> <span class="n">hdr</span><span class="o">.</span><span class="n">dop_res</span><span class="p">,</span> <span class="mf">129.0</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">hdr</span><span class="o">.</span><span class="n">sw_offset</span><span class="p">:</span>
            <span class="n">read_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hdr</span><span class="o">.</span><span class="n">sw_offset</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">msg1_data_hdr</span><span class="p">(</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span> <span class="n">hdr</span><span class="o">.</span><span class="n">doppler_first_gate</span><span class="p">,</span>
                                                 <span class="n">hdr</span><span class="o">.</span><span class="n">doppler_gate_width</span><span class="p">,</span>
                                                 <span class="n">hdr</span><span class="o">.</span><span class="n">doppler_num_gates</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">129.0</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">data_hdr</span> <span class="ow">in</span> <span class="n">read_info</span><span class="p">:</span>
            <span class="c1"># Jump and read</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="n">ptr</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">data_hdr</span><span class="o">.</span><span class="n">num_gates</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">))</span>

            <span class="c1"># Scale and flag data</span>
            <span class="n">scaled_vals</span> <span class="o">=</span> <span class="p">(</span><span class="n">vals</span> <span class="o">-</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">scale</span>
            <span class="n">scaled_vals</span><span class="p">[</span><span class="n">vals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span>
            <span class="n">scaled_vals</span><span class="p">[</span><span class="n">vals</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RANGE_FOLD</span>

            <span class="c1"># Store</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">data_hdr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_hdr</span><span class="p">,</span> <span class="n">scaled_vals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_sweep</span><span class="p">(</span><span class="n">hdr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hdr</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">))</span>

    <span class="n">msg2_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;rda_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Start-Up&#39;</span><span class="p">,</span> <span class="s1">&#39;Standby&#39;</span><span class="p">,</span> <span class="s1">&#39;Restart&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Operate&#39;</span><span class="p">,</span> <span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Off-line Operate&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;op_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;On-Line&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Maintenance Action Required&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Maintenance Action Mandatory&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Commanded Shut Down&#39;</span><span class="p">,</span> <span class="s1">&#39;Inoperable&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;Automatic Calibration&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;control_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Local Only&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;RPG (Remote) Only&#39;</span><span class="p">,</span> <span class="s1">&#39;Either&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;aux_power_gen_state&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Switch to Aux Power&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;Utility PWR Available&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;Generator On&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;Transfer Switch Manual&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;Commanded Switchover&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;avg_tx_pwr&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ref_calib_cor&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;data_transmission_enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                                    <span class="s1">&#39;Reflectivity&#39;</span><span class="p">,</span> <span class="s1">&#39;Velocity&#39;</span><span class="p">,</span> <span class="s1">&#39;Width&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;vcp_num&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rda_control_auth&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;No Action&#39;</span><span class="p">,</span>
                                                             <span class="s1">&#39;Local Control Requested&#39;</span><span class="p">,</span>
                                                             <span class="s1">&#39;Remote Control Enabled&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;rda_build&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;op_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span>
                                                               <span class="s1">&#39;Operational&#39;</span><span class="p">,</span> <span class="s1">&#39;Maintenance&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;super_res_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;cmd_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">Bits</span><span class="p">(</span><span class="mi">6</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;avset_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;rda_alarm_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;No Alarms&#39;</span><span class="p">,</span> <span class="s1">&#39;Tower/Utilities&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;Pedestal&#39;</span><span class="p">,</span> <span class="s1">&#39;Transmitter&#39;</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;RDA Control&#39;</span><span class="p">,</span> <span class="s1">&#39;Communication&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;Signal Processor&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;command_acknowledge&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Remote VCP Received&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;Clutter Bypass map received&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;Redundant Chan Ctrl Cmd received&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;channel_control_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;spot_blanking&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;bypass_map_gen_date&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bypass_map_gen_time&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;clutter_filter_map_gen_date&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;clutter_filter_map_gen_time&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;transition_pwr_src_state&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Off&#39;</span><span class="p">,</span> <span class="s1">&#39;OK&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;RMS_control_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;RMS in control&#39;</span><span class="p">,</span> <span class="s1">&#39;RDA in control&#39;</span><span class="p">)),</span>
        <span class="c1"># See Table IV-A for definition of alarms</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;alarms&#39;</span><span class="p">,</span> <span class="s1">&#39;28s&#39;</span><span class="p">,</span> <span class="n">Array</span><span class="p">(</span><span class="s1">&#39;&gt;14H&#39;</span><span class="p">))],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Msg2Fmt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_msg2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rda_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg2_fmt</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_size</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg2_fmt</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_msg3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">._nexrad_msgs.msg3</span> <span class="k">import</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maintenance_data_desc</span> <span class="o">=</span> <span class="n">descriptions</span>
        <span class="n">msg_fmt</span> <span class="o">=</span> <span class="n">DictStruct</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maintenance_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="n">msg_fmt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_size</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">,</span> <span class="n">msg_fmt</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="n">vcp_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;size_hw&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;pattern_type&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_el_cuts&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;clutter_map_group&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;dop_res&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;pulse_width&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Short&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;10x&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;els&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;VCPFmt&#39;</span><span class="p">)</span>

    <span class="n">vcp_el_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;channel_config&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;Constant Phase&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Phase&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;SZ2 Phase&#39;</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;waveform&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Contiguous Surveillance&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Contig. Doppler with Ambiguity Res.&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Contig. Doppler without Ambiguity Res.&#39;</span><span class="p">,</span>
                                                     <span class="s1">&#39;Batch&#39;</span><span class="p">,</span> <span class="s1">&#39;Staggered Pulse Pair&#39;</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;super_res&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;0.5 azimuth and 0.25km range res.&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;Doppler to 300km&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;Dual Polarization Control&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;Dual Polarization to 300km&#39;</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;surv_prf_num&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;surv_pulse_count&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;az_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">az_rate</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;ref_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.125</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;vel_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.125</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;sw_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.125</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;zdr_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.125</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;phidp_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.125</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;rhohv_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.125</span><span class="p">)),</span>
                              <span class="p">(</span><span class="s1">&#39;sector1_edge&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector1_doppler_prf_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector1_pulse_count&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector2_edge&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector2_doppler_prf_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector2_pulse_count&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector3_edge&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector3_doppler_prf_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;sector3_pulse_count&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;VCPEl&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_msg5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="n">vcp_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcp_fmt</span><span class="p">)</span>
        <span class="n">els</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcp_el_fmt</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vcp_info</span><span class="o">.</span><span class="n">num_el_cuts</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcp_info</span> <span class="o">=</span> <span class="n">vcp_info</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">els</span><span class="o">=</span><span class="n">els</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_size</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">vcp_fmt</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">vcp_info</span><span class="o">.</span><span class="n">num_el_cuts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcp_el_fmt</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_msg13</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_segment</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;&gt;</span><span class="si">{:d}</span><span class="s1">h&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="n">bmap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">num_el</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">bmap</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">bmap</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bit_conv</span> <span class="o">=</span> <span class="n">Bits</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_el</span><span class="p">):</span>
                <span class="n">seg_num</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">assert</span> <span class="n">seg_num</span> <span class="o">==</span> <span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Message 13 segments out of sync --&#39;</span>
                                            <span class="s1">&#39; read </span><span class="si">{}</span><span class="s1"> but on </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seg_num</span><span class="p">,</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

                <span class="n">az_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">360</span><span class="p">):</span>
                    <span class="n">gates</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
                        <span class="n">gates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">bit_conv</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">]))</span>
                        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">az_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gates</span><span class="p">)</span>
                <span class="n">bmap</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az_data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clutter_filter_bypass_map</span> <span class="o">=</span> <span class="n">bmap</span>

            <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Message 13 left data -- Used: </span><span class="si">%d</span><span class="s1"> Avail: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="n">msg15_code_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Bypass Filter&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Bypass map in Control&#39;</span><span class="p">,</span>
                      <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Force Filter&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_decode_msg15</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="c1"># buffer the segments until we have the whole thing. The data</span>
        <span class="c1"># will be returned concatenated when this is the case</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_segment</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;&gt;</span><span class="si">{:d}</span><span class="s1">h&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">num_el</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">cmap</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">cmap</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_el</span><span class="p">):</span>
                <span class="n">az_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">360</span><span class="p">):</span>
                    <span class="n">num_rng</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">codes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_rng</span> <span class="o">+</span> <span class="n">offset</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="n">ends</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_rng</span> <span class="o">+</span> <span class="n">offset</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_rng</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">az_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ends</span><span class="p">,</span> <span class="n">codes</span><span class="p">)))</span>
                <span class="n">cmap</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">az_data</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">clutter_filter_map</span> <span class="o">=</span> <span class="n">cmap</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Message 15 left data -- Used: </span><span class="si">%d</span><span class="s1"> Avail: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_decode_msg18</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="c1"># buffer the segments until we have the whole thing. The data</span>
        <span class="c1"># will be returned concatenated when this is the case</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_segment</span><span class="p">(</span><span class="n">msg_hdr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">._nexrad_msgs.msg18</span> <span class="k">import</span> <span class="n">descriptions</span><span class="p">,</span> <span class="n">fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rda_adaptation_desc</span> <span class="o">=</span> <span class="n">descriptions</span>

            <span class="c1"># Can&#39;t use NamedStruct because we have more than 255 items--this</span>
            <span class="c1"># is a CPython limit for arguments.</span>
            <span class="n">msg_fmt</span> <span class="o">=</span> <span class="n">DictStruct</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rda</span> <span class="o">=</span> <span class="n">msg_fmt</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">301</span><span class="p">):</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;VCPAT&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rda</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
                <span class="n">vcp_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcp_fmt</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">off</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcp_fmt</span><span class="o">.</span><span class="n">size</span>
                <span class="n">els</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vcp_hdr</span><span class="o">.</span><span class="n">num_el_cuts</span><span class="p">):</span>
                    <span class="n">els</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcp_el_fmt</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">off</span><span class="p">))</span>
                    <span class="n">off</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcp_el_fmt</span><span class="o">.</span><span class="n">size</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rda</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcp_hdr</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">els</span><span class="o">=</span><span class="n">els</span><span class="p">)</span>

    <span class="n">msg31_data_hdr_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;stid&#39;</span><span class="p">,</span> <span class="s1">&#39;4s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;time_ms&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;az_num&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;az_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rad_length&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;az_spacing&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;rad_status&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">remap_status</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;el_num&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sector_num&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;spot_blanking&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Radial&#39;</span><span class="p">,</span> <span class="s1">&#39;Elevation&#39;</span><span class="p">,</span>
                                                                      <span class="s1">&#39;Volume&#39;</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;az_index_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;num_data_blks&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;vol_const_ptr&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;el_const_ptr&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;rad_const_ptr&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Msg31DataHdr&#39;</span><span class="p">)</span>

    <span class="n">msg31_vol_const_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;3s&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;site_amsl&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;feedhorn_agl&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;calib_dbz&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;txpower_h&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;txpower_v&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sys_zdr&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;phidp0&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vcp&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                       <span class="p">(</span><span class="s1">&#39;processing_status&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;RxR Noise&#39;</span><span class="p">,</span>
                                                                           <span class="s1">&#39;CBT&#39;</span><span class="p">))],</span>
                                      <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;VolConsts&#39;</span><span class="p">)</span>

    <span class="n">msg31_el_const_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;3s&#39;</span><span class="p">),</span>
                                      <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;atmos_atten&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;calib_dbz0&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;ElConsts&#39;</span><span class="p">)</span>

    <span class="n">rad_const_fmt_v1</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;3s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;unamb_range&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                    <span class="p">(</span><span class="s1">&#39;noise_h&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;noise_v&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;nyq_vel&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)),</span>
                                    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;RadConstsV1&#39;</span><span class="p">)</span>
    <span class="n">rad_const_fmt_v2</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;3s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;unamb_range&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                    <span class="p">(</span><span class="s1">&#39;noise_h&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;noise_v&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;nyq_vel&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)),</span>
                                    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2x&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;calib_dbz0_h&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;calib_dbz0_v&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;RadConstsV2&#39;</span><span class="p">)</span>

    <span class="n">data_block_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;3s&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_gates&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s1">&#39;first_gate&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                                  <span class="p">(</span><span class="s1">&#39;gate_width&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)),</span>
                                  <span class="p">(</span><span class="s1">&#39;tover&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                  <span class="p">(</span><span class="s1">&#39;snr_thresh&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                  <span class="p">(</span><span class="s1">&#39;recombined&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Azimuths&#39;</span><span class="p">,</span> <span class="s1">&#39;Gates&#39;</span><span class="p">)),</span>
                                  <span class="p">(</span><span class="s1">&#39;data_size&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">bits_to_code</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;DataBlockHdr&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_msg31</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="n">msg_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
        <span class="n">data_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg31_data_hdr_fmt</span><span class="p">)</span>

        <span class="c1"># Read all the data block pointers separately. This simplifies just</span>
        <span class="c1"># iterating over them</span>
        <span class="n">ptrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;&gt;L&#39;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">compression</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Compressed message 31 not supported!&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">vol_const_ptr</span><span class="p">)</span>
        <span class="n">vol_consts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg31_vol_const_fmt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">el_const_ptr</span><span class="p">)</span>
        <span class="n">el_consts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg31_el_const_fmt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">rad_const_ptr</span><span class="p">)</span>
        <span class="c1"># Major version jumped with Build 14.0</span>
        <span class="k">if</span> <span class="n">vol_consts</span><span class="o">.</span><span class="n">major</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">rad_consts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rad_const_fmt_v1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rad_consts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rad_const_fmt_v2</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">block_count</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">ptr</span> <span class="ow">in</span> <span class="n">ptrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptr</span><span class="p">:</span>
                <span class="n">block_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="n">ptr</span><span class="p">)</span>
                <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_block_fmt</span><span class="p">)</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">num_gates</span><span class="p">,</span>
                                                         <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">hdr</span><span class="o">.</span><span class="n">data_size</span><span class="p">))</span>
                <span class="n">scaled_vals</span> <span class="o">=</span> <span class="p">(</span><span class="n">vals</span> <span class="o">-</span> <span class="n">hdr</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">hdr</span><span class="o">.</span><span class="n">scale</span>
                <span class="n">scaled_vals</span><span class="p">[</span><span class="n">vals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span>
                <span class="n">scaled_vals</span><span class="p">[</span><span class="n">vals</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RANGE_FOLD</span>
                <span class="n">data</span><span class="p">[</span><span class="n">hdr</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">scaled_vals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_sweep</span><span class="p">(</span><span class="n">data_hdr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data_hdr</span><span class="p">,</span> <span class="n">vol_consts</span><span class="p">,</span> <span class="n">el_consts</span><span class="p">,</span> <span class="n">rad_consts</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">num_data_blks</span> <span class="o">!=</span> <span class="n">block_count</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Incorrect number of blocks detected -- Got </span><span class="si">%d</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;instead of </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">block_count</span><span class="p">,</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">num_data_blks</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">data_hdr</span><span class="o">.</span><span class="n">rad_length</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">msg_start</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_buffer_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">):</span>
        <span class="c1"># Add to the buffer</span>
        <span class="n">bufs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_buf</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">bufs</span><span class="p">[</span><span class="n">msg_hdr</span><span class="o">.</span><span class="n">segment_num</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">size_hw</span> <span class="o">-</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">msg_hdr_fmt</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># Warn for badly formatted data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bufs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">segment_num</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Segment out of order (Got: </span><span class="si">%d</span><span class="s1"> Count: </span><span class="si">%d</span><span class="s1">) for message type </span><span class="si">%d</span><span class="s1">.&#39;</span><span class="p">,</span>
                        <span class="n">msg_hdr</span><span class="o">.</span><span class="n">segment_num</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bufs</span><span class="p">),</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span><span class="p">)</span>

        <span class="c1"># If we&#39;re complete, return the full collection of data</span>
        <span class="k">if</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">num_segments</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bufs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg_buf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bufs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">_add_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdr</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hdr</span><span class="o">.</span><span class="n">rad_status</span> <span class="o">&amp;</span> <span class="n">START_VOLUME</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Missed start of volume!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hdr</span><span class="o">.</span><span class="n">rad_status</span> <span class="o">&amp;</span> <span class="n">START_ELEVATION</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="p">)</span> <span class="o">!=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">el_num</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Missed elevation -- Have </span><span class="si">%d</span><span class="s1"> but data on </span><span class="si">%d</span><span class="s1">.&#39;</span>
                        <span class="s1">&#39; Compensating...&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="p">),</span> <span class="n">hdr</span><span class="o">.</span><span class="n">el_num</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">hdr</span><span class="o">.</span><span class="n">el_num</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sweeps</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

    <span class="k">def</span> <span class="nf">_check_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_hdr</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">hdr_size</span> <span class="o">=</span> <span class="n">msg_hdr</span><span class="o">.</span><span class="n">size_hw</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg_hdr_fmt</span><span class="o">.</span><span class="n">size</span>
        <span class="k">assert</span> <span class="n">size</span> <span class="o">==</span> <span class="n">hdr_size</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Message type </span><span class="si">{}</span><span class="s1"> should be </span><span class="si">{}</span><span class="s1"> bytes &#39;</span>
                                  <span class="s1">&#39;but got </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg_hdr</span><span class="o">.</span><span class="n">msg_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">hdr_size</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">reduce_lists</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Replace single item lists in a dictionary with the single item.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">old_data</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">two_comp16</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the two&#39;s-complement signed representation of a 16-bit unsigned integer.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">~</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0x7fff</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">val</span>


<span class="k">def</span> <span class="nf">float16</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert a 16-bit floating point value to a standard Python float.&quot;&quot;&quot;</span>
    <span class="c1"># Fraction is 10 LSB, Exponent middle 5, and Sign the MSB</span>
    <span class="n">frac</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0x03ff</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1F</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span>

    <span class="k">if</span> <span class="n">exp</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">exp</span> <span class="o">-</span> <span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">**</span><span class="mi">9</span>

    <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">float32</span><span class="p">(</span><span class="n">short1</span><span class="p">,</span> <span class="n">short2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unpack a pair of 16-bit integers as a Python float.&quot;&quot;&quot;</span>
    <span class="c1"># Masking below in python will properly convert signed values to unsigned</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;f&#39;</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;HH&#39;</span><span class="p">,</span> <span class="n">short1</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="n">short2</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">date_elem</span><span class="p">(</span><span class="n">ind_days</span><span class="p">,</span> <span class="n">ind_minutes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function to parse a datetime from the product-specific blocks.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">ind_days</span><span class="p">],</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind_minutes</span><span class="p">]</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="k">def</span> <span class="nf">scaled_elem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function to scale a certain product-specific block.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="k">def</span> <span class="nf">combine_elem</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function to combine two specified product-specific blocks into a single int.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
        <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">seq</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">seq</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">shift</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="k">def</span> <span class="nf">float_elem</span><span class="p">(</span><span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function to combine two specified product-specific blocks into a float.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">seq</span><span class="p">:</span> <span class="n">float32</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">ind1</span><span class="p">],</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind2</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">high_byte</span><span class="p">(</span><span class="n">ind</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function to return the high-byte of a product-specific block.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="k">def</span> <span class="nf">low_byte</span><span class="p">(</span><span class="n">ind</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a function to return the low-byte of a product-specific block.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span>
    <span class="k">return</span> <span class="n">inner</span>


<span class="c1"># Data mappers used to take packed data and turn into physical units</span>
<span class="c1"># Default is to use numpy array indexing to use LUT to change data bytes</span>
<span class="c1"># into physical values. Can also have a &#39;labels&#39; attribute to give</span>
<span class="c1"># categorical labels</span>
<span class="k">class</span> <span class="nc">DataMapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert packed integer data into physical units.&quot;&quot;&quot;</span>

    <span class="c1"># Need to find way to handle range folded</span>
    <span class="c1"># RANGE_FOLD = -9999</span>
    <span class="n">RANGE_FOLD</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
    <span class="n">MISSING</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">data</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">DigitalMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Maps packed integers to floats using a scale and offset from the product.&quot;&quot;&quot;</span>

    <span class="n">_min_scale</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">_inc_scale</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">_min_data</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">_max_data</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="n">range_fold</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the mapper and the lookup table.&quot;&quot;&quot;</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="n">two_comp16</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_scale</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inc_scale</span>
        <span class="n">num_levels</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span>

        <span class="c1"># Generate lookup table -- sanity check on num_levels handles</span>
        <span class="c1"># the fact that DHR advertises 256 levels, which *includes*</span>
        <span class="c1"># missing, differing from other products</span>
        <span class="n">num_levels</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_levels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_data</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_levels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_data</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_val</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">inc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DigitalRefMapper</span><span class="p">(</span><span class="n">DigitalMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for digital reflectivity products.&quot;&quot;&quot;</span>

    <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;dBZ&#39;</span>


<span class="k">class</span> <span class="nc">DigitalVelMapper</span><span class="p">(</span><span class="n">DigitalMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for digital velocity products.&quot;&quot;&quot;</span>

    <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m/s&#39;</span>
    <span class="n">range_fold</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">class</span> <span class="nc">DigitalSPWMapper</span><span class="p">(</span><span class="n">DigitalVelMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for digital spectrum width products.&quot;&quot;&quot;</span>

    <span class="n">_min_data</span> <span class="o">=</span> <span class="mi">129</span>
    <span class="n">_max_data</span> <span class="o">=</span> <span class="mi">149</span>


<span class="k">class</span> <span class="nc">PrecipArrayMapper</span><span class="p">(</span><span class="n">DigitalMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for precipitation array products.&quot;&quot;&quot;</span>

    <span class="n">_inc_scale</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">_min_data</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_max_data</span> <span class="o">=</span> <span class="mi">254</span>
    <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;dBA&#39;</span>


<span class="k">class</span> <span class="nc">DigitalStormPrecipMapper</span><span class="p">(</span><span class="n">DigitalMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for digital storm precipitation products.&quot;&quot;&quot;</span>

    <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;inches&#39;</span>
    <span class="n">_inc_scale</span> <span class="o">=</span> <span class="mf">0.01</span>


<span class="k">class</span> <span class="nc">DigitalVILMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for digital VIL products.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the VIL mapper.&quot;&quot;&quot;</span>
        <span class="n">lin_scale</span> <span class="o">=</span> <span class="n">float16</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">lin_offset</span> <span class="o">=</span> <span class="n">float16</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">log_start</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">log_scale</span> <span class="o">=</span> <span class="n">float16</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">log_offset</span> <span class="o">=</span> <span class="n">float16</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">256</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span><span class="p">)</span>

        <span class="c1"># VIL is allowed to use 2 through 254 inclusive. 0 is thresholded,</span>
        <span class="c1"># 1 is flagged, and 255 is reserved</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">log_start</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">log_start</span><span class="p">]</span> <span class="o">-</span> <span class="n">lin_offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">lin_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">log_start</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">ind</span><span class="p">[</span><span class="n">log_start</span><span class="p">:]</span> <span class="o">-</span> <span class="n">log_offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">log_scale</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DigitalEETMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for digital echo tops products.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the mapper.&quot;&quot;&quot;</span>
        <span class="n">data_mask</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">topped_mask</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topped_lut</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">256</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">data_mask</span><span class="p">)</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">topped_lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">topped_mask</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topped_lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topped_lut</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert the data values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">data_vals</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">topped_lut</span><span class="p">[</span><span class="n">data_vals</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">GenericDigitalMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Maps packed integers to floats using a scale and offset from the product.</span>

<span class="sd">    Also handles special data flags.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the mapper by pulling out all the information from the product.&quot;&quot;&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">float32</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">float32</span><span class="p">(</span><span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">max_data_val</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">leading_flags</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">trailing_flags</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

        <span class="c1"># Values will be [0, max] inclusive, so need to add 1 to max value to get proper size.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_data_val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">leading_flags</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RANGE_FOLD</span>

        <span class="c1"># Need to add 1 to the end of the range so that it&#39;s inclusive</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leading_flags</span><span class="p">,</span> <span class="n">max_data_val</span> <span class="o">-</span> <span class="n">trailing_flags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DigitalHMCMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for hydrometeor classification products.</span>

<span class="sd">    Handles assigning string labels based on values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ND&#39;</span><span class="p">,</span> <span class="s1">&#39;BI&#39;</span><span class="p">,</span> <span class="s1">&#39;GC&#39;</span><span class="p">,</span> <span class="s1">&#39;IC&#39;</span><span class="p">,</span> <span class="s1">&#39;DS&#39;</span><span class="p">,</span> <span class="s1">&#39;WS&#39;</span><span class="p">,</span> <span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">,</span>
              <span class="s1">&#39;BD&#39;</span><span class="p">,</span> <span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;HA&#39;</span><span class="p">,</span> <span class="s1">&#39;UK&#39;</span><span class="p">,</span> <span class="s1">&#39;RF&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the mapper.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="mi">150</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RANGE_FOLD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">)</span>


<span class="c1"># 156, 157</span>
<span class="k">class</span> <span class="nc">EDRMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for eddy dissipation rate products.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the mapper based on the product.&quot;&quot;&quot;</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span>
        <span class="n">data_levels</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">leading_flags</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span><span class="p">]</span> <span class="o">*</span> <span class="n">data_levels</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leading_flags</span><span class="p">,</span> <span class="n">data_levels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LegacyMapper</span><span class="p">(</span><span class="n">DataMapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapper for legacy products.&quot;&quot;&quot;</span>

    <span class="n">lut_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Blank&#39;</span><span class="p">,</span> <span class="s1">&#39;TH&#39;</span><span class="p">,</span> <span class="s1">&#39;ND&#39;</span><span class="p">,</span> <span class="s1">&#39;RF&#39;</span><span class="p">,</span> <span class="s1">&#39;BI&#39;</span><span class="p">,</span> <span class="s1">&#39;GC&#39;</span><span class="p">,</span> <span class="s1">&#39;IC&#39;</span><span class="p">,</span> <span class="s1">&#39;GR&#39;</span><span class="p">,</span> <span class="s1">&#39;WS&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;DS&#39;</span><span class="p">,</span> <span class="s1">&#39;RA&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">,</span> <span class="s1">&#39;BD&#39;</span><span class="p">,</span> <span class="s1">&#39;HA&#39;</span><span class="p">,</span> <span class="s1">&#39;UK&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prod</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the values and labels from the product.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">prod</span><span class="o">.</span><span class="n">thresholds</span><span class="p">:</span>
            <span class="n">codes</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">t</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">t</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lut_names</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Blank&#39;</span><span class="p">,</span> <span class="s1">&#39;TH&#39;</span><span class="p">,</span> <span class="s1">&#39;ND&#39;</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MISSING</span>
                <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;RF&#39;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RANGE_FOLD</span>

            <span class="k">elif</span> <span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">*=</span> <span class="mf">0.01</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">*=</span> <span class="mf">0.05</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">*=</span> <span class="mf">0.1</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">codes</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">label</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span> <span class="o">+</span> <span class="n">label</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">label</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">codes</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">+</span> <span class="n">label</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">)</span>


<div class="viewcode-block" id="Level3File"><a class="viewcode-back" href="../../../api/generated/metpy.io.Level3File.html#metpy.io.Level3File">[docs]</a><span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">class</span> <span class="nc">Level3File</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Handle reading the wide array of NEXRAD Level 3 (NIDS) product files.</span>

<span class="sd">    This class attempts to decode every byte that is in a given product file.</span>
<span class="sd">    It supports all of the various compression formats that exist for these</span>
<span class="sd">    products in the wild.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    metadata : dict</span>
<span class="sd">        Various general metadata available from the product</span>
<span class="sd">    header : namedtuple</span>
<span class="sd">        Decoded product header</span>
<span class="sd">    prod_desc : namedtuple</span>
<span class="sd">        Decoded product description block</span>
<span class="sd">    siteID : str</span>
<span class="sd">        ID of the site found in the header, empty string if none found</span>
<span class="sd">    lat : float</span>
<span class="sd">        Radar site latitude</span>
<span class="sd">    lon : float</span>
<span class="sd">        Radar site longitude</span>
<span class="sd">    height : float</span>
<span class="sd">        Radar site height AMSL</span>
<span class="sd">    product_name : str</span>
<span class="sd">        Name of the product contained in file</span>
<span class="sd">    max_range : float</span>
<span class="sd">        Maximum range of the product, taken from the NIDS ICD</span>
<span class="sd">    map_data : Mapper</span>
<span class="sd">        Class instance mapping data int values to proper floating point values</span>
<span class="sd">    sym_block : list, optional</span>
<span class="sd">        Any symbology block packets that were found</span>
<span class="sd">    tab_pages : list, optional</span>
<span class="sd">        Any tabular pages that were found</span>
<span class="sd">    graph_pages : list, optional</span>
<span class="sd">        Any graphical pages that were found</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The internal data structure that things are decoded into is still to be</span>
<span class="sd">    determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ij_to_km</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">wmo_finder</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;((?:NX|SD|NO)US)\d</span><span class="si">{2}</span><span class="s1">[\s\w\d]+\w*(\w</span><span class="si">{3}</span><span class="s1">)</span><span class="se">\r\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">header_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;msg_len&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;src_id&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dest_id&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">&#39;num_blks&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;MsgHdr&#39;</span><span class="p">)</span>
    <span class="c1"># See figure 3-17 in 2620001 document for definition of status bit fields</span>
    <span class="n">gsm_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;block_len&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;op_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Clear Air&#39;</span><span class="p">,</span> <span class="s1">&#39;Precip&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rda_op_status&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Online&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Maintenance Required&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Maintenance Mandatory&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Commanded Shutdown&#39;</span><span class="p">,</span> <span class="s1">&#39;Inoperable&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Wideband Disconnect&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;vcp&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_el&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;el1&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el2&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el3&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el4&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el5&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el6&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el7&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el8&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el9&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el10&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el11&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el12&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el13&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el14&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el15&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el16&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el17&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el18&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el19&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;el20&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rda_status&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Startup&#39;</span><span class="p">,</span> <span class="s1">&#39;Standby&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Restart&#39;</span><span class="p">,</span> <span class="s1">&#39;Operate&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Off-line Operate&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rda_alarms&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Indeterminate&#39;</span><span class="p">,</span> <span class="s1">&#39;Tower/Utilities&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Pedestal&#39;</span><span class="p">,</span> <span class="s1">&#39;Transmitter&#39;</span><span class="p">,</span> <span class="s1">&#39;Receiver&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;RDA Control&#39;</span><span class="p">,</span> <span class="s1">&#39;RDA Communications&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Signal Processor&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;tranmission_enable&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;Reflectivity&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;Velocity&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum Width&#39;</span><span class="p">,</span>
                                                                <span class="s1">&#39;Dual Pol&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rpg_op_status&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Loadshed&#39;</span><span class="p">,</span> <span class="s1">&#39;Online&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Maintenance Required&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Maintenance Mandatory&#39;</span><span class="p">,</span>
                                                           <span class="s1">&#39;Commanded shutdown&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rpg_alarms&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Node Connectivity&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Wideband Failure&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;RPG Control Task Failure&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Data Base Failure&#39;</span><span class="p">,</span> <span class="s1">&#39;Spare&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;RPG Input Buffer Loadshed&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Product Storage Loadshed&#39;</span>
                                                        <span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Spare&#39;</span><span class="p">,</span> <span class="s1">&#39;Spare&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;RPG/RPG Intercomputer Link Failure&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Redundant Channel Error&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Task Failure&#39;</span><span class="p">,</span> <span class="s1">&#39;Media Failure&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rpg_status&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Restart&#39;</span><span class="p">,</span> <span class="s1">&#39;Operate&#39;</span><span class="p">,</span> <span class="s1">&#39;Standby&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rpg_narrowband_status&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Commanded Disconnect&#39;</span><span class="p">,</span>
                                                                   <span class="s1">&#39;Narrowband Loadshed&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;h_ref_calib&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;prod_avail&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;Product Availability&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Degraded Availability&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;Not Available&#39;</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;super_res_cuts&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">Bits</span><span class="p">(</span><span class="mi">16</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;cmd_status&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">Bits</span><span class="p">(</span><span class="mi">6</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;v_ref_calib&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rda_build&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rda_channel&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;reserved&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;reserved2&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;build_version&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;GSM&#39;</span><span class="p">)</span>
    <span class="c1"># Build 14.0 added more bytes to the GSM</span>
    <span class="n">additional_gsm_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;el21&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;el22&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;el23&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;el24&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;el25&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;vcp_supplemental&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">BitField</span><span class="p">(</span><span class="s1">&#39;AVSET&#39;</span><span class="p">,</span>
                                                                         <span class="s1">&#39;SAILS&#39;</span><span class="p">,</span>
                                                                         <span class="s1">&#39;site_vcp&#39;</span><span class="p">,</span>
                                                                         <span class="s1">&#39;RxR Noise&#39;</span><span class="p">,</span>
                                                                         <span class="s1">&#39;CBT&#39;</span><span class="p">)),</span>
                                      <span class="p">(</span><span class="s1">&#39;spare&#39;</span><span class="p">,</span> <span class="s1">&#39;84s&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;GSM&#39;</span><span class="p">)</span>
    <span class="n">prod_desc_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;prod_code&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;op_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vcp&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;seq_num&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;vol_num&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vol_date&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;vol_start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;prod_gen_date&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;prod_gen_time&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep1&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;dep2&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;el_num&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep3&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;thr1&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr2&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr3&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;thr4&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr5&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr6&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;thr7&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr8&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr9&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;thr10&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr11&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr12&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;thr13&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr14&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;thr15&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;thr16&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep4&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep5&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;dep6&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep7&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep8&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;dep9&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dep10&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;spot_blank&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sym_off&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;graph_off&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;tab_off&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;ProdDesc&#39;</span><span class="p">)</span>
    <span class="n">sym_block_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                 <span class="p">(</span><span class="s1">&#39;block_len&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;nlayer&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;SymBlock&#39;</span><span class="p">)</span>
    <span class="n">tab_header_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="s1">&#39;block_len&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;TabHeader&#39;</span><span class="p">)</span>
    <span class="n">tab_block_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_pages&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;TabBlock&#39;</span><span class="p">)</span>
    <span class="n">sym_layer_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;SymLayer&#39;</span><span class="p">)</span>
    <span class="n">graph_block_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;divider&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;block_id&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                                   <span class="p">(</span><span class="s1">&#39;block_len&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_pages&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;GraphBlock&#39;</span><span class="p">)</span>
    <span class="n">standalone_tabular</span> <span class="o">=</span> <span class="p">[</span><span class="mi">62</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">82</span><span class="p">]</span>
    <span class="n">prod_spec_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">16</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">17</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">18</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">19</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">20</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">21</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">22</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity&#39;</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">23</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity&#39;</span><span class="p">,</span> <span class="mf">115.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">24</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">25</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity&#39;</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">26</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity&#39;</span><span class="p">,</span> <span class="mf">115.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">27</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">28</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Spectrum Width&#39;</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
                     <span class="mi">29</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Spectrum Width&#39;</span><span class="p">,</span> <span class="mf">115.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
                     <span class="mi">30</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Spectrum Width&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
                     <span class="mi">31</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;User Selectable Storm Total Precipitation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;end_hour&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;hour_span&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;max_rainfall&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)))),</span>
                     <span class="mi">32</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Hybrid Scan Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">DigitalRefMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;avg_time&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">33</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Hybrid Scan Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;avg_time&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))),</span>
                     <span class="mi">34</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Clutter Filter Control&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;clutter_bitmap&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;cmd_map&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;bypass_map_date&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;notchwidth_map_date&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)))),</span>
                     <span class="mi">35</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">36</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">37</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">38</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">41</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Echo Tops&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)))),</span>  <span class="c1"># Max in ft</span>
                     <span class="mi">48</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;VAD Wind Profile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;dir_max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;alt_max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))),</span>  <span class="c1"># Max in ft</span>
                     <span class="mi">55</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Storm Relative Mean Radial Velocity&#39;</span><span class="p">,</span> <span class="mf">50.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;window_az&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;window_range&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;avg_speed&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;avg_dir&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;alert_category&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">))),</span>
                     <span class="mi">56</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Storm Relative Mean Radial Velocity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;avg_speed&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;avg_dir&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)))),</span>
                     <span class="mi">57</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Vertically Integrated Liquid&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>  <span class="c1"># Max in kg / m^2</span>
                     <span class="mi">58</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Storm Tracking Information&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;num_storms&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),)),</span>
                     <span class="mi">59</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Hail Index&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span> <span class="p">()),</span>
                     <span class="mi">61</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Tornado Vortex Signature&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;num_tvs&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_etvs&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">62</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Storm Structure&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span> <span class="p">()),</span>
                     <span class="mi">63</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity (Layer 1 Average)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">64</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity (Layer 2 Average)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">65</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity (Layer 1 Max)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">66</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity (Layer 2 Max)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">67</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity - AP Removed&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">74</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Radar Coded Message&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span> <span class="p">()),</span>
                     <span class="mi">78</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Surface Rainfall Accumulation (1 hour)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max_rainfall&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)))),</span>
                     <span class="mi">79</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Surface Rainfall Accumulation (3 hour)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max_rainfall&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)))),</span>
                     <span class="mi">80</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Storm Total Rainfall Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max_rainfall&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)))),</span>
                     <span class="mi">81</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Hourly Digital Precipitation Array&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">PrecipArrayMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max_rainfall&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)))),</span>
                     <span class="mi">82</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Supplemental Precipitation Data&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span> <span class="p">()),</span>
                     <span class="mi">89</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity (Layer 3 Average)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">90</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Layer Composite Reflectivity (Layer 3 Max)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_bottom&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;layer_top&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">93</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ITWS Digital Base Velocity&#39;</span><span class="p">,</span> <span class="mf">115.</span><span class="p">,</span> <span class="n">DigitalVelMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">))),</span>
                     <span class="mi">94</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Reflectivity Data Array&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">DigitalRefMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">95</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity Edited for AP&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">96</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity Edited for AP&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">97</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity Edited for AP&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">98</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Composite Reflectivity Edited for AP&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;calib_const&#39;</span><span class="p">,</span> <span class="n">float_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)))),</span>
                     <span class="mi">99</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Base Velocity Data Array&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="n">DigitalVelMapper</span><span class="p">,</span>
                          <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                           <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">132</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Clutter Likelihood Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),)),</span>
                     <span class="mi">133</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Clutter Likelihood Doppler&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),)),</span>
                     <span class="mi">134</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;High Resolution VIL&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">DigitalVILMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;num_edited&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">135</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Enhanced Echo Tops&#39;</span><span class="p">,</span> <span class="mf">345.</span><span class="p">,</span> <span class="n">DigitalEETMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">)),</span>  <span class="c1"># Max in ft</span>
                            <span class="p">(</span><span class="s1">&#39;num_edited&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;ref_thresh&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;points_removed&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">138</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Storm Total Precipitation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">DigitalStormPrecipMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">141</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Mesocyclone Detection&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;min_ref_thresh&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;overlap_display_filter&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;min_strength_rank&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span>
                     <span class="mi">152</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Archive III Status Product&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">153</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Super Resolution Reflectivity Data Array&#39;</span><span class="p">,</span> <span class="mf">460.</span><span class="p">,</span> <span class="n">DigitalRefMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">154</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Super Resolution Velocity Data Array&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="n">DigitalVelMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">155</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Super Resolution Spectrum Width Data Array&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span>
                           <span class="n">DigitalSPWMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">156</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Turbulence Detection (Eddy Dissipation Rate)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">EDRMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_start_time&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;el_end_time&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min_el&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;mean_el&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max_el&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)))),</span>
                     <span class="mi">157</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Turbulence Detection (Eddy Dissipation Rate Confidence)&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span>
                           <span class="n">EDRMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_start_time&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;el_end_time&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min_el&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;mean_el&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max_el&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)))),</span>
                     <span class="mi">158</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Differential Reflectivity&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)))),</span>
                     <span class="mi">159</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Differential Reflectivity&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">160</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Correlation Coefficient&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.00333</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.00333</span><span class="p">)))),</span>
                     <span class="mi">161</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Correlation Coefficient&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.00333</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.00333</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">162</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Specific Differential Phase&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)))),</span>
                     <span class="mi">163</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Specific Differential Phase&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">164</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Hydrometeor Classification&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),)),</span>
                     <span class="mi">165</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Hydrometeor Classification&#39;</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="n">DigitalHMCMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">166</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Melting Layer&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),)),</span>
                     <span class="mi">169</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;One Hour Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)))),</span>
                     <span class="mi">170</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Accumulation Array&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">171</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Storm Total Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;gr_pairs&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)))),</span>
                     <span class="mi">172</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Storm total Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">173</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital User-Selectable Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;missing_period&#39;</span><span class="p">,</span> <span class="n">high_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">174</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital One-Hour Difference Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span>
                           <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">175</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Storm Total Difference Accumulation&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span>
                           <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;null_product&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;rainfall_end&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">176</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Digital Instantaneous Precipitation Rate&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span>
                           <span class="n">GenericDigitalMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;rainfall_begin&#39;</span><span class="p">,</span> <span class="n">date_elem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;precip_detected&#39;</span><span class="p">,</span> <span class="n">high_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;need_bias&#39;</span><span class="p">,</span> <span class="n">low_byte</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;percent_filled&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max_elev&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;bias&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">177</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Hybrid Hydrometeor Classification&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">DigitalHMCMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;mode_filter_size&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;hybrid_percent_filled&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;max_elev&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">180</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">DigitalRefMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">181</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
                     <span class="mi">182</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Base Velocity&#39;</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">DigitalVelMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">183</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Base Velocity&#39;</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">))),</span>
                     <span class="mi">185</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Base Spectrum Width&#39;</span><span class="p">,</span> <span class="mf">90.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">))),</span>
                     <span class="mi">186</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Long Range Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">416.</span><span class="p">,</span> <span class="n">DigitalRefMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))),</span>
                     <span class="mi">187</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;TDWR Long Range Base Reflectivity&#39;</span><span class="p">,</span> <span class="mf">416.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                           <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span>
                            <span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))}</span>

<div class="viewcode-block" id="Level3File.__init__"><a class="viewcode-back" href="../../../api/generated/metpy.io.Level3File.html#metpy.io.Level3File.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create instance of `Level3File`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str or file-like object</span>
<span class="sd">            If str, the name of the file to be opened. If file-like object,</span>
<span class="sd">            this will be read from directly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fobj</span> <span class="o">=</span> <span class="n">open_as_needed</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="k">if</span> <span class="n">is_string_like</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;No File&#39;</span>

        <span class="c1"># Just read in the entire set of data at once</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">closing</span><span class="p">(</span><span class="n">fobj</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">IOBuffer</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>

        <span class="c1"># Pop off the WMO header if we find it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_wmo_header</span><span class="p">()</span>

        <span class="c1"># Pop off last 4 bytes if necessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_end_bytes</span><span class="p">()</span>

        <span class="c1"># Set up places to store data and metadata</span>
<span class="c1">#        self.data = []</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Handle free text message products that are pure text</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wmo_code</span> <span class="o">==</span> <span class="s1">&#39;NOUS&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depVals</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">product_name</span> <span class="o">=</span> <span class="s1">&#39;Free Text Message&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">())</span>
            <span class="k">return</span>

        <span class="c1"># Decompress the data if necessary, and if so, pop off new header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">IOBuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_func</span><span class="p">(</span><span class="n">zlib_decompress_all_frames</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_wmo_header</span><span class="p">()</span>

        <span class="c1"># Check for empty product</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Empty product!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Unpack the message header and the product description block</span>
        <span class="n">msg_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Buffer size: </span><span class="si">%d</span><span class="s1"> (</span><span class="si">%d</span><span class="s1"> expected) Header: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">msg_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">check_remains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">msg_len</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Product contains an unexpected amount of data remaining--have: </span><span class="si">%d</span><span class="s1"> &#39;</span>
                        <span class="s1">&#39;expected: </span><span class="si">%d</span><span class="s1">. This product may not parse correctly.&#39;</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">msg_len</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># Handle GSM and jump out</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsm_fmt</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsm</span><span class="o">.</span><span class="n">divider</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsm</span><span class="o">.</span><span class="n">block_len</span> <span class="o">&gt;</span> <span class="mi">82</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gsm_additional</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_gsm_fmt</span><span class="p">)</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsm</span><span class="o">.</span><span class="n">block_len</span> <span class="o">==</span> <span class="mi">178</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsm</span><span class="o">.</span><span class="n">block_len</span> <span class="o">==</span> <span class="mi">82</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc_fmt</span><span class="p">)</span>

        <span class="c1"># Convert thresholds and dependent values to lists of values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="p">,</span> <span class="s1">&#39;thr&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depVals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="p">,</span> <span class="s1">&#39;dep&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>

        <span class="c1"># Set up some time/location metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;msg_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;vol_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">vol_date</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">vol_start_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;prod_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nexrad_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">prod_gen_date</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">prod_gen_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">lat</span> <span class="o">*</span> <span class="mf">0.001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">lon</span> <span class="o">*</span> <span class="mf">0.001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">height</span>

        <span class="c1"># Handle product-specific blocks. Default to compression and elevation angle</span>
        <span class="c1"># Also get other product specific information, like name,</span>
        <span class="c1"># maximum range, and how to map data bytes to values</span>
        <span class="n">default</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Unknown Product&#39;</span><span class="p">,</span> <span class="mf">230.</span><span class="p">,</span> <span class="n">LegacyMapper</span><span class="p">,</span>
                   <span class="p">((</span><span class="s1">&#39;el_angle&#39;</span><span class="p">,</span> <span class="n">scaled_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">,</span> <span class="n">combine_elem</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;defaultVals&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_range</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_spec_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depVals</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depVals</span><span class="p">[</span><span class="n">block</span><span class="p">]</span>

        <span class="c1"># Now that we have the header, we have everything needed to make tables</span>
        <span class="c1"># Store as class that can be called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_data</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Process compression if indicated. We need to fail</span>
        <span class="c1"># gracefully here since we default to it being on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">comp_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
                <span class="n">decomp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_func</span><span class="p">(</span><span class="n">bz2</span><span class="o">.</span><span class="n">decompress</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">splice</span><span class="p">(</span><span class="n">comp_start</span><span class="p">,</span> <span class="n">decomp_data</span><span class="p">)</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">check_remains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># Unpack the various blocks, if present. The factor of 2 converts from</span>
        <span class="c1"># &#39;half-words&#39; to bytes</span>
        <span class="c1"># Check to see if this is one of the &quot;special&quot; products that uses</span>
        <span class="c1"># header-free blocks and re-assigns the offsets</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">standalone_tabular</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">sym_off</span><span class="p">:</span>
                <span class="c1"># For standalone tabular alphanumeric, symbology offset is</span>
                <span class="c1"># actually tabular</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_tabblock</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">sym_off</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">graph_off</span><span class="p">:</span>
                <span class="c1"># Offset seems to be off by 1 from where we&#39;re counting, but</span>
                <span class="c1"># it&#39;s not clear why.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_standalone_graphblock</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span>
                                                   <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">graph_off</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1"># Need special handling for (old) radar coded message format</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">74</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_rcm</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">sym_off</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">sym_off</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_symblock</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">sym_off</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">graph_off</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_graphblock</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">graph_off</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">tab_off</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_tabblock</span><span class="p">(</span><span class="n">msg_start</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="o">.</span><span class="n">tab_off</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;defaultVals&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Using default metadata for product </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">code</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_process_wmo_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Read off the WMO header if necessary</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">get_next</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wmo_finder</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;WMO Header: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wmo_code</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">siteID</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wmo_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_process_end_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">check_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;End Bytes: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">check_bytes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check_bytes</span> <span class="ow">in</span> <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\r\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff\xff\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_unpack_rle_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="c1"># Unpack Run-length encoded data</span>
        <span class="n">unpacked</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">run</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="n">run</span> <span class="o">&amp;</span> <span class="mh">0x0F</span>
            <span class="n">unpacked</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">val</span><span class="p">]</span> <span class="o">*</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unpacked</span>

<div class="viewcode-block" id="Level3File.pos_scale"><a class="viewcode-back" href="../../../api/generated/metpy.io.Level3File.html#metpy.io.Level3File.pos_scale">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pos_scale</span><span class="p">(</span><span class="n">is_sym_block</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Scale of the position information in km.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.25</span> <span class="k">if</span> <span class="n">is_sym_block</span> <span class="k">else</span> <span class="mi">1</span></div>

    <span class="k">def</span> <span class="nf">_unpack_rcm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;1234 ROBUU&#39;</span>
        <span class="n">text_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Appendix B of ICD tells how to interpret this stuff, but that just</span>
        <span class="c1"># doesn&#39;t seem worth it.</span>
        <span class="k">for</span> <span class="n">marker</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;BB&#39;</span><span class="p">,</span> <span class="s1">&#39;vad&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;CC&#39;</span><span class="p">,</span> <span class="s1">&#39;remarks&#39;</span><span class="p">)]:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">text_data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/NEXR&#39;</span> <span class="o">+</span> <span class="n">marker</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
            <span class="c1"># For part C the search for end fails, but returns -1, which works</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">text_data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;/END&#39;</span> <span class="o">+</span> <span class="n">marker</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rcm_&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">text_data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_unpack_symblock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">blk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sym_block_fmt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sym_block</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="n">blk</span><span class="o">.</span><span class="n">divider</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Bad divider for symbology block: </span><span class="si">{:d}</span><span class="s1"> should be -1&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blk</span><span class="o">.</span><span class="n">divider</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">blk</span><span class="o">.</span><span class="n">block_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Bad block ID for symbology block: </span><span class="si">{:d}</span><span class="s1"> should be 1&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blk</span><span class="o">.</span><span class="n">block_id</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blk</span><span class="o">.</span><span class="n">nlayer</span><span class="p">):</span>
            <span class="n">layer_hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sym_layer_fmt</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">layer_hdr</span><span class="o">.</span><span class="n">divider</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sym_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
            <span class="n">layer_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">layer_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">layer_hdr</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
                <span class="n">packet_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">packet_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">:</span>
                    <span class="n">layer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">[</span><span class="n">packet_code</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown symbology packet type </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">layer_start</span><span class="p">,</span> <span class="n">layer_hdr</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">layer_start</span><span class="p">)</span> <span class="o">==</span> <span class="n">layer_hdr</span><span class="o">.</span><span class="n">length</span>

    <span class="k">def</span> <span class="nf">_unpack_graphblock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_block_fmt</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">hdr</span><span class="o">.</span><span class="n">divider</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Bad divider for graphical block: </span><span class="si">{:d}</span><span class="s1"> should be -1&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">divider</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">hdr</span><span class="o">.</span><span class="n">block_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Bad block ID for graphical block: </span><span class="si">{:d}</span><span class="s1"> should be 1&#39;</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">block_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_pages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">num_pages</span><span class="p">):</span>
            <span class="n">page_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">page</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">page_num</span>
            <span class="n">page_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="n">page_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
            <span class="n">packets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">page_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">page_size</span><span class="p">:</span>
                <span class="n">packet_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">packet_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">:</span>
                    <span class="n">packets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">[</span><span class="n">packet_code</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown graphical packet type </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">page_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packets</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unpack_standalone_graphblock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">packets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">at_end</span><span class="p">():</span>
            <span class="n">packet_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">packet_code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">:</span>
                <span class="n">packets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">[</span><span class="n">packet_code</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown standalone graphical packet type </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">,</span> <span class="n">packet_code</span><span class="p">)</span>
                <span class="c1"># Assume next 2 bytes is packet length and try skipping</span>
                <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_pages</span> <span class="o">=</span> <span class="p">[</span><span class="n">packets</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_unpack_tabblock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">have_header</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="n">block_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>

        <span class="c1"># Read the header and validate if needed</span>
        <span class="k">if</span> <span class="n">have_header</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_header_fmt</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">header</span><span class="o">.</span><span class="n">divider</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">assert</span> <span class="n">header</span><span class="o">.</span><span class="n">block_id</span> <span class="o">==</span> <span class="mi">3</span>

            <span class="c1"># Read off secondary message and product description blocks,</span>
            <span class="c1"># but as far as I can tell, all we really need is the text that follows</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_fmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prod_desc_fmt</span><span class="p">)</span>

        <span class="c1"># Get the start of the block with number of pages and divider</span>
        <span class="n">blk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_block_fmt</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">blk</span><span class="o">.</span><span class="n">divider</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Read the pages line by line, break pages on a -1 character count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_pages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">blk</span><span class="o">.</span><span class="n">num_pages</span><span class="p">):</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">num_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">num_chars</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">(</span><span class="n">num_chars</span><span class="p">)))</span>
                <span class="n">num_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tab_pages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">have_header</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">block_start</span><span class="p">)</span> <span class="o">==</span> <span class="n">header</span><span class="o">.</span><span class="n">block_len</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the string representation of the product.&quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">product_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod_desc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">depVals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">siteID</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_radial_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">hdr_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;ind_first_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;nbins&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;i_center&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;j_center&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;scale_factor&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_rad&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)],</span>
                              <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialHeader&#39;</span><span class="p">)</span>
        <span class="n">rad_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;num_hwords&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;start_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;angle_delta&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;RadialData&#39;</span><span class="p">)</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="n">hdr_fmt</span><span class="p">)</span>
        <span class="n">rads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">num_rad</span><span class="p">):</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="n">rad_fmt</span><span class="p">)</span>
            <span class="n">start_az</span> <span class="o">=</span> <span class="n">rad</span><span class="o">.</span><span class="n">start_angle</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">end_az</span> <span class="o">=</span> <span class="n">start_az</span> <span class="o">+</span> <span class="n">rad</span><span class="o">.</span><span class="n">angle_delta</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">rads</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_az</span><span class="p">,</span> <span class="n">end_az</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_rle_data</span><span class="p">(</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rad</span><span class="o">.</span><span class="n">num_hwords</span><span class="p">))))</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rads</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;start_az&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="s1">&#39;end_az&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span>
                <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">i_center</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">),</span>
                           <span class="n">hdr</span><span class="o">.</span><span class="n">j_center</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)),</span>
                <span class="s1">&#39;gate_scale&#39;</span><span class="p">:</span> <span class="n">hdr</span><span class="o">.</span><span class="n">scale_factor</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="n">hdr</span><span class="o">.</span><span class="n">ind_first_bin</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_digital_radial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">hdr_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;ind_first_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;nbins&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;i_center&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;j_center&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;scale_factor&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;num_rad&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">)],</span>
                              <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;DigitalRadialHeader&#39;</span><span class="p">)</span>
        <span class="n">rad_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;num_bytes&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;start_angle&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;angle_delta&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;DigitalRadialData&#39;</span><span class="p">)</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="n">hdr_fmt</span><span class="p">)</span>
        <span class="n">rads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">num_rad</span><span class="p">):</span>
            <span class="n">rad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="n">rad_fmt</span><span class="p">)</span>
            <span class="n">start_az</span> <span class="o">=</span> <span class="n">rad</span><span class="o">.</span><span class="n">start_angle</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">end_az</span> <span class="o">=</span> <span class="n">start_az</span> <span class="o">+</span> <span class="n">rad</span><span class="o">.</span><span class="n">angle_delta</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="n">rads</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_az</span><span class="p">,</span> <span class="n">end_az</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">rad</span><span class="o">.</span><span class="n">num_bytes</span><span class="p">)))</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">vals</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">rads</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;start_az&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="s1">&#39;end_az&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span>
                <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">i_center</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">),</span>
                           <span class="n">hdr</span><span class="o">.</span><span class="n">j_center</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)),</span>
                <span class="s1">&#39;gate_scale&#39;</span><span class="p">:</span> <span class="n">hdr</span><span class="o">.</span><span class="n">scale_factor</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="n">hdr</span><span class="o">.</span><span class="n">ind_first_bin</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_raster_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">hdr_fmt</span> <span class="o">=</span> <span class="n">NamedStruct</span><span class="p">([(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;i_start&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;j_start&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>  <span class="c1"># start in km/4</span>
                               <span class="p">(</span><span class="s1">&#39;xscale_int&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;xscale_frac&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;yscale_int&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;yscale_frac&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span>
                               <span class="p">(</span><span class="s1">&#39;num_rows&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;packing&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)],</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;RasterData&#39;</span><span class="p">)</span>
        <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_struct</span><span class="p">(</span><span class="n">hdr_fmt</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">hdr</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mh">0x800000C0</span>
        <span class="k">assert</span> <span class="n">hdr</span><span class="o">.</span><span class="n">packing</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hdr</span><span class="o">.</span><span class="n">num_rows</span><span class="p">):</span>
            <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpack_rle_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;start_x&#39;</span><span class="p">:</span> <span class="n">hdr</span><span class="o">.</span><span class="n">i_start</span> <span class="o">*</span> <span class="n">hdr</span><span class="o">.</span><span class="n">xscale_int</span><span class="p">,</span>
                <span class="s1">&#39;start_y&#39;</span><span class="p">:</span> <span class="n">hdr</span><span class="o">.</span><span class="n">j_start</span> <span class="o">*</span> <span class="n">hdr</span><span class="o">.</span><span class="n">yscale_int</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rows</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_uniform_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="c1"># By not using a struct, we can handle multiple codes</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="n">read_bytes</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">read_bytes</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">i_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
        <span class="n">j_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>

        <span class="c1"># Text is what remains beyond what&#39;s been read, not including byte count</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">(</span><span class="n">num_bytes</span> <span class="o">-</span> <span class="n">read_bytes</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">i_start</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">),</span>
                <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">j_start</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">),</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_special_text_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_packet_uniform_text</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">)</span>

        <span class="c1"># Translate special characters to their meaning</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">symbol_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;!&#39;</span><span class="p">:</span> <span class="s1">&#39;past storm position&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span> <span class="s1">&#39;current storm position&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;#&#39;</span><span class="p">:</span> <span class="s1">&#39;forecast storm position&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">:</span> <span class="s1">&#39;past MDA position&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;%&#39;</span><span class="p">:</span> <span class="s1">&#39;forecast MDA position&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="c1"># Use this meaning as the key in the returned packet</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">symbol_map</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown special symbol </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">symbol_map</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_special_graphic_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">type_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Mesocyclone&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="s1">&#39;3D Correlated Shear&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="s1">&#39;TVS&#39;</span><span class="p">,</span>
                    <span class="mi">26</span><span class="p">:</span> <span class="s1">&#39;ETVS&#39;</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span> <span class="s1">&#39;Positive Hail&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">:</span> <span class="s1">&#39;Probable Hail&#39;</span><span class="p">,</span>
                    <span class="mi">15</span><span class="p">:</span> <span class="s1">&#39;Storm ID&#39;</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span> <span class="s1">&#39;HDA&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">:</span> <span class="s1">&#39;STI Circle&#39;</span><span class="p">}</span>
        <span class="n">point_feature_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Mesocyclone (ext.)&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Mesocyclone&#39;</span><span class="p">,</span>
                             <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;TVS (Ext.)&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;ETVS (Ext.)&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;TVS&#39;</span><span class="p">,</span>
                             <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;ETVS&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;MDA&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;MDA (Elev.)&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="s1">&#39;MDA (Weak)&#39;</span><span class="p">}</span>

        <span class="c1"># Read the number of bytes and set a mark for sanity checking</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="n">packet_data_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)</span>

        <span class="c1"># Loop over the bytes we have</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">packet_data_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_bytes</span><span class="p">:</span>
            <span class="c1"># Read position</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

            <span class="c1"># Handle any types that have additional info</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;POH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">))</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;POSH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">))</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;Max Size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kind</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">kind</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">point_feature_map</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown graphic symbol point kind </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Unknown (</span><span class="si">{:d}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kind</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_feature_map</span><span class="p">[</span><span class="n">kind</span><span class="p">])</span>

        <span class="c1"># Map the code to a name for this type of symbol</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_map</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown graphic symbol type </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_map</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>

        <span class="c1"># Check and return</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">packet_data_start</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_bytes</span>

        <span class="c1"># Reduce dimensions of lists if possible</span>
        <span class="n">reduce_lists</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_scit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="n">packet_data_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">packet_data_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_bytes</span><span class="p">:</span>
            <span class="n">next_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">next_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unknown packet in SCIT </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">next_code</span><span class="p">,</span> <span class="n">next_code</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">jump_to</span><span class="p">(</span><span class="n">packet_data_start</span><span class="p">,</span> <span class="n">num_bytes</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ret</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_packet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packet_map</span><span class="p">[</span><span class="n">next_code</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">next_code</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;track&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_packet</span><span class="p">[</span><span class="s1">&#39;vectors&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">next_code</span> <span class="o">==</span> <span class="mi">25</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;STI Circle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_packet</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">next_code</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;markers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_packet</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unsupported packet in SCIT </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">next_code</span><span class="p">,</span> <span class="n">next_code</span><span class="p">)</span>
                    <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_packet</span><span class="p">)</span>
        <span class="n">reduce_lists</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_digital_precipitation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="c1"># Read off a couple of unused spares</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>

        <span class="c1"># Get the size of the grid</span>
        <span class="n">lfm_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Read off each row and decode the RLE data</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">):</span>
            <span class="n">row_num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
            <span class="n">row_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">row_num_bytes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_rle_data</span><span class="p">(</span><span class="n">row_bytes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">run</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row_bytes</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">row_bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">level</span><span class="p">]</span> <span class="o">*</span> <span class="n">run</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="n">lfm_boxes</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">rows</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_linked_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
            <span class="n">num_bytes</span> <span class="o">-=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="o">*</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&gt;h&#39;</span><span class="p">)]</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;vectors&#39;</span><span class="p">:</span> <span class="n">vectors</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
            <span class="n">num_bytes</span> <span class="o">-=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&gt;h&#39;</span><span class="p">)]</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">[::</span><span class="mi">4</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">4</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">4</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="p">]))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;vectors&#39;</span><span class="p">:</span> <span class="n">vectors</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_contour_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="c1"># Check for color value indicator</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0002</span>

        <span class="c1"># Read and return value (level) of contour</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_linked_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="c1"># Check for initial point indicator</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x8000</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)</span>
        <span class="n">startx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
        <span class="n">starty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
        <span class="n">vectors</span> <span class="o">=</span> <span class="p">[(</span><span class="n">startx</span><span class="p">,</span> <span class="n">starty</span><span class="p">)]</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="o">*</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_binary</span><span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&gt;h&#39;</span><span class="p">)]</span>
        <span class="n">vectors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;vectors&#39;</span><span class="p">:</span> <span class="n">vectors</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_wind_barbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="c1"># Figure out how much to read</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
        <span class="n">packet_data_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="c1"># Read while we have data, then return</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">packet_data_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_bytes</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">))</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">))</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">))</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;direc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">))</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_generic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="c1"># Reserved HW</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="c1"># Read number of bytes (2 HW) and return</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;l&#39;</span><span class="p">)</span>
        <span class="n">hunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span>
        <span class="n">xdrparser</span> <span class="o">=</span> <span class="n">Level3XDRParser</span><span class="p">(</span><span class="n">hunk</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xdrparser</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_trend_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>  <span class="c1"># number of bytes, not needed to process</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;times&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_trends</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">_unpack_packet_cell_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">in_sym_block</span><span class="p">):</span>
        <span class="n">code_map</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Cell Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Cell Base&#39;</span><span class="p">,</span> <span class="s1">&#39;Max Reflectivity Height&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Probability of Hail&#39;</span><span class="p">,</span> <span class="s1">&#39;Probability of Severe Hail&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Cell-based VIL&#39;</span><span class="p">,</span> <span class="s1">&#39;Maximum Reflectivity&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Centroid Height&#39;</span><span class="p">]</span>
        <span class="n">code_scales</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
        <span class="n">packet_data_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">set_mark</span><span class="p">()</span>
        <span class="n">cell_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_ascii</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_scale</span><span class="p">(</span><span class="n">in_sym_block</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cell_id</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">}</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">offset_from</span><span class="p">(</span><span class="n">packet_data_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_bytes</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">code</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">code_map</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">code_scales</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Unsupported trend code </span><span class="si">%d</span><span class="s1">/</span><span class="si">%x</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_trends</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> Limited&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">700</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">700</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="o">*</span> <span class="n">scale</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_read_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num_vols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">latest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read_int</span><span class="p">(</span><span class="s1">&#39;&gt;h&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vols</span><span class="p">)]</span>

        <span class="c1"># Wrap the circular buffer so that latest is last</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">latest</span><span class="p">:]</span> <span class="o">+</span> <span class="n">vals</span><span class="p">[:</span><span class="n">latest</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vals</span>

    <span class="n">packet_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">_unpack_packet_uniform_text</span><span class="p">,</span>
                  <span class="mi">2</span><span class="p">:</span> <span class="n">_unpack_packet_special_text_symbol</span><span class="p">,</span>
                  <span class="mi">3</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">4</span><span class="p">:</span> <span class="n">_unpack_packet_wind_barbs</span><span class="p">,</span>
                  <span class="mi">6</span><span class="p">:</span> <span class="n">_unpack_packet_linked_vector</span><span class="p">,</span>
                  <span class="mi">8</span><span class="p">:</span> <span class="n">_unpack_packet_uniform_text</span><span class="p">,</span>
                  <span class="c1"># 9: _unpack_packet_linked_vector,</span>
                  <span class="mi">10</span><span class="p">:</span> <span class="n">_unpack_packet_vector</span><span class="p">,</span>
                  <span class="mi">11</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">12</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">13</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">14</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">15</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">16</span><span class="p">:</span> <span class="n">_unpack_packet_digital_radial</span><span class="p">,</span>
                  <span class="mi">17</span><span class="p">:</span> <span class="n">_unpack_packet_digital_precipitation</span><span class="p">,</span>
                  <span class="mi">18</span><span class="p">:</span> <span class="n">_unpack_packet_digital_precipitation</span><span class="p">,</span>
                  <span class="mi">19</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">20</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">21</span><span class="p">:</span> <span class="n">_unpack_packet_cell_trend</span><span class="p">,</span>
                  <span class="mi">22</span><span class="p">:</span> <span class="n">_unpack_packet_trend_times</span><span class="p">,</span>
                  <span class="mi">23</span><span class="p">:</span> <span class="n">_unpack_packet_scit</span><span class="p">,</span>
                  <span class="mi">24</span><span class="p">:</span> <span class="n">_unpack_packet_scit</span><span class="p">,</span>
                  <span class="mi">25</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">26</span><span class="p">:</span> <span class="n">_unpack_packet_special_graphic_symbol</span><span class="p">,</span>
                  <span class="mi">28</span><span class="p">:</span> <span class="n">_unpack_packet_generic</span><span class="p">,</span>
                  <span class="mi">29</span><span class="p">:</span> <span class="n">_unpack_packet_generic</span><span class="p">,</span>
                  <span class="mh">0x0802</span><span class="p">:</span> <span class="n">_unpack_packet_contour_color</span><span class="p">,</span>
                  <span class="mh">0x0E03</span><span class="p">:</span> <span class="n">_unpack_packet_linked_contour</span><span class="p">,</span>
                  <span class="mh">0xaf1f</span><span class="p">:</span> <span class="n">_unpack_packet_radial_data</span><span class="p">,</span>
                  <span class="mh">0xba07</span><span class="p">:</span> <span class="n">_unpack_packet_raster_data</span><span class="p">}</span></div>


<span class="k">class</span> <span class="nc">Level3XDRParser</span><span class="p">(</span><span class="n">Unpacker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handle XDR-formatted Level 3 NEXRAD products.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform the actual unpacking.&quot;&quot;&quot;</span>
        <span class="n">xdr</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
            <span class="n">xdr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpack_prod_desc</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;XDR: code </span><span class="si">%d</span><span class="s1"> not implemented&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>

        <span class="c1"># Check that we got it all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">xdr</span>

    <span class="k">def</span> <span class="nf">unpack_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unpack the internal data as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Unpacker</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unpack_prod_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xdr</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># NOTE: The ICD (262001U) incorrectly lists op-mode, vcp, el_num, and</span>
        <span class="c1"># spare as int*2. Changing to int*4 makes things parse correctly.</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;prod_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;radar_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;vol_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;el_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_uint</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;el_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;vol_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;op_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;vcp_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;el_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;uncompressed_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_parameters</span><span class="p">()</span>
        <span class="n">xdr</span><span class="p">[</span><span class="s1">&#39;components&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_components</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">xdr</span>

    <span class="k">def</span> <span class="nf">_unpack_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>

        <span class="c1"># ICD documents a &quot;pointer&quot; here, that seems to be garbage. Just read</span>
        <span class="c1"># and use the number, starting the list immediately.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># Another pointer for the &#39;list&#39; ?</span>

        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_unpack_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>

        <span class="c1"># ICD documents a &quot;pointer&quot; here, that seems to be garbage. Just read</span>
        <span class="c1"># and use the number, starting the list immediately.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_lookup</span><span class="p">[</span><span class="n">code</span><span class="p">](</span><span class="bp">self</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>  <span class="c1"># Another pointer for the &#39;list&#39; ?</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unknown XDR Component: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="n">radial_fmt</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;RadialComponent&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;gate_width&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;first_gate&#39;</span><span class="p">,</span> <span class="s1">&#39;parameters&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;radials&#39;</span><span class="p">])</span>
    <span class="n">radial_data_fmt</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;RadialData&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;azimuth&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;num_bins&#39;</span><span class="p">,</span> <span class="s1">&#39;attributes&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;data&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_unpack_radial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radial_fmt</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">(),</span>
                              <span class="n">gate_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">(),</span>
                              <span class="n">first_gate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">(),</span>
                              <span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpack_parameters</span><span class="p">(),</span>
                              <span class="n">radials</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">num_rads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">()</span>
        <span class="n">rads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rads</span><span class="p">):</span>
            <span class="c1"># ICD is wrong, says num_bins is float, should be int</span>
            <span class="n">rads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radial_data_fmt</span><span class="p">(</span><span class="n">azimuth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">(),</span>
                                             <span class="n">elevation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">(),</span>
                                             <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_float</span><span class="p">(),</span>
                                             <span class="n">num_bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">(),</span>
                                             <span class="n">attributes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">(),</span>
                                             <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_int</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">radials</span><span class="o">=</span><span class="n">rads</span><span class="p">)</span>

    <span class="n">text_fmt</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;TextComponent&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_unpack_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_fmt</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpack_parameters</span><span class="p">(),</span>
                             <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unpack_string</span><span class="p">())</span>

    <span class="n">_component_lookup</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">_unpack_radial</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_unpack_text</span><span class="p">}</span>


<div class="viewcode-block" id="is_precip_mode"><a class="viewcode-back" href="../../../api/generated/metpy.io.is_precip_mode.html#metpy.io.is_precip_mode">[docs]</a><span class="nd">@exporter</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">is_precip_mode</span><span class="p">(</span><span class="n">vcp_num</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if the NEXRAD radar is operating in precipitation mode.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vcp_num : int</span>
<span class="sd">        The NEXRAD volume coverage pattern (VCP) number</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        True if the VCP corresponds to precipitation mode, False otherwise</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">vcp_num</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">3</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, MetPy Developers.
      Last updated on Apr 12, 2018 at 00:47:55.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92978945-1', 'auto');
  ga('send', 'pageview');
</script>
<script>var version_json_loc = "../../../../versions.json";</script>
<p>Do you enjoy using MetPy?
  <a href="https://saythanks.io/to/unidata" class="btn btn-neutral" title="Say Thanks!" accesskey="n">Say Thanks!</a>
</p>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.7.0+135.gaac1d34',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../../_static/pop_ver.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>